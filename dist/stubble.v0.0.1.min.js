/*! Stubble ~ Tiny Hairy Templates - v0.0.1 - 2013-05-05
* http://www.asbjornenge.com/stubble
* Copyright (c) 2013 @asbjornenge; Licensed  */
var stub=function(t,e){if(stub.templates.hasOwnProperty(t)){for(var r=$(stub.templates[t]).clone(),n=r[0].getElementsByTagName("*"),a=n.length;a--;)stub.handle_attributes(n[a],e),stub.handle_textnodes(n[a],e);return stub.handle_attributes(r[0],e),stub.handle_textnodes(r[0],e),r}};stub.reg=RegExp("{{(.*?)}}","g"),stub.templates={},stub.events={},stub.events.init=function(){var t=document.createEvent("HTMLEvents");t.initEvent("databind",!1,!1),stub.events.databind=t},stub.events.init(),stub.filters={extract:function(t){t.extracted=stub.extract(t.obj,t.prop)},_null:function(t){null==t.extracted&&(t.extracted="")},_undef:function(t){void 0===t.extracted&&(t.extracted="")},replace:function(t){if("attribute"===t.type){var e=t.node.attributes[t.attribute];e.value=e.value.replace(t.expr,t.extracted)}if("text"===t.type){var r=t.child;r.textContent=r.textContent.replace(t.expr,t.extracted)}},"default":"@_null@_undef"},stub.match=function(t){var e=t.match(stub.reg);if(null!=e&&0!==e.length){for(var r=[],n=e.length;n--;){for(var a={filters:[],expr:e[n]},s=[],u=e[n].slice(2,-2).split("@"),l=u.length;l--;)0===l?a.prop=u[l]:s.push(u[l]);s=stub.filters["default"].split("@").concat(s);for(var i=s.length;i--;)void 0!==stub.filters[s[i]]&&a.filters.push(stub.filters[s[i]]);a.filters.reverse(),r.push(a)}return r}},stub.handle_attributes=function(t,e){for(var r=t.attributes,n=r.length;n--;){var a=stub.match(r[n].value);if(a&&0!==a.length)for(var s=a.length;s--;){var u={node:t,obj:e,prop:a[s].prop,expr:a[s].expr,type:"attribute",attribute:r[n].name};stub.filters.extract(u);for(var l in a[s].filters)a[s].filters[l](u);stub.filters.replace(u)}}},stub.handle_textnodes=function(t,e){for(var r=t.childNodes,n=r.length;n--;){var a=r[n];if(3===a.nodeType){var s=stub.match(a.textContent);if(!s||0===s.length)continue;for(var u=s.length;u--;){var l={node:t,obj:e,prop:s[u].prop,expr:s[u].expr,type:"text",child:a};stub.filters.extract(l);for(var i in s[u].filters)s[u].filters[i](l);stub.filters.replace(l)}}}},stub.load=function(){$("[template]").each(function(t,e){var r=$(e),n=r.attr("template");r.removeAttr("template"),stub.templates[n]=r[0],$(e).remove()})},stub.extract=function(t,e,r){for(var n,a,s=t,u=e.replace(/\[(\w+)\]/g,".$1").replace(/^\./,"").split(".");u.length;){if(a=u.shift(),!(a in s))return;n=s,s=s[a]}return void 0!==r&&"object"==typeof n&&(n[a]=r),s};