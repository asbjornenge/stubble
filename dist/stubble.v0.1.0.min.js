/*! stubble - v0.1.0 - 2013-07-18
* http://www.asbjornenge.com/stubble
* Copyright (c) 2013 Asbjorn Enge; Licensed BSD */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define([],b):a.stub=b()}(this,function(){"use strict";var a=function(b,c){if(a.templates.hasOwnProperty(b)){for(var d=a.templates[b].cloneNode(!0),e=d.getElementsByTagName("*"),f=e.length;f--;)a.handle_attributes(e[f],c),a.handle_textnodes(e[f],c);return a.handle_attributes(d,c),a.handle_textnodes(d,c),d}};return a.reg=new RegExp("{{(.*?)}}","g"),a.templates={},a.filters={extract:function(b){b.extracted=a.extract(b.obj,b.prop)},_null:function(a){null===a.extracted&&(a.extracted="")},_undef:function(a){void 0===a.extracted&&(a.extracted="")},replace:function(a){if("attribute"===a.type){var b=a.node.attributes[a.attribute];b.value=b.value.replace(a.expr,a.extracted)}if("text"===a.type){var c=a.child;c.textContent=c.textContent.replace(a.expr,a.extracted)}},"default":"@_null@_undef"},a.match=function(b){var c=b.match(a.reg);if(null!==c&&0!==c.length){for(var d=[],e=c.length;e--;){for(var f={filters:[],expr:c[e]},g=[],h=c[e].slice(2,-2).split("@"),i=h.length;i--;)0===i?f.prop=h[i]:g.push(h[i]);g=a.filters["default"].split("@").concat(g);for(var j=g.length;j--;)void 0!==a.filters[g[j]]&&f.filters.push(a.filters[g[j]]);f.filters.reverse(),d.push(f)}return d}},a.handle_attributes=function(b,c){if(void 0!==c)for(var d=b.attributes,e=d.length;e--;){var f=a.match(d[e].value);if(f&&0!==f.length)for(var g=f.length;g--;){var h={node:b,obj:c,prop:f[g].prop,expr:f[g].expr,type:"attribute",attribute:d[e].name};a.filters.extract(h);for(var i in f[g].filters)f[g].filters[i](h);a.filters.replace(h)}}},a.handle_textnodes=function(b,c){if(void 0!==c)for(var d=b.childNodes,e=d.length;e--;){var f=d[e];if(3===f.nodeType){var g=a.match(f.textContent);if(!g||0===g.length)continue;for(var h=g.length;h--;){var i={node:b,obj:c,prop:g[h].prop,expr:g[h].expr,type:"text",child:f};a.filters.extract(i);for(var j in g[h].filters)g[h].filters[j](i);a.filters.replace(i)}}}},a.load=function(){for(var b=document.getElementsByTagName("*"),c=[],d=0;d<b.length;d++){var e=b[d],f=e.getAttribute("data-stub");f&&(a.templates[f]=e)}for(var g in a.templates){var h=a.templates[g];h.parentNode.removeChild(h)}return c},a.extract=function(a,b,c){for(var d,e,f=a,g=b.replace(/\[(\w+)\]/g,".$1").replace(/^\./,"").split(".");g.length;){if(e=g.shift(),!(e in f))return;d=f,f=f[e]}return void 0!==c&&"object"==typeof d&&(d[e]=c),f},a});